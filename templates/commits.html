<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Commits</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #1e3c72;
            text-align: center;
            margin-bottom: 10px;
            font-size: 36px;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 16px;
        }
        
        #chart_div {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Analyse de mes Commits GitHub</h1>
        <p class="subtitle">Distribution des commits par minute (0-59)</p>
        
        <div id="loading" class="loading">‚è≥ Chargement des donn√©es...</div>
        <div id="chart_div"></div>
        
        <div class="stats" id="stats"></div>
    </div>
    
    <script>
        google.charts.load('current', { packages: ['corechart'] });
        google.charts.setOnLoadCallback(loadData);
        
        function loadData() {
            fetch('/commits/')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').style.display = 'none';
                    drawChart(data);
                    displayStats(data);
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    document.getElementById('loading').innerHTML = '‚ùå Erreur de chargement';
                });
        }
        
        function drawChart(data) {
            var dataTable = new google.visualization.DataTable();
            dataTable.addColumn('string', 'Minute');
            dataTable.addColumn('number', 'Nombre de commits');
            
            // Ajouter les donn√©es
            data.results.forEach(entry => {
                dataTable.addRow(['Minute ' + entry.minute, entry.count]);
            });
            
            var options = {
                title: 'R√©partition des commits par minute',
                hAxis: {
                    title: 'Minute de l\'heure (0-59)',
                    slantedText: true,
                    slantedTextAngle: 45
                },
                vAxis: {
                    title: 'Nombre de commits',
                    minValue: 0
                },
                colors: ['#667eea'],
                bar: { groupWidth: '90%' },
                legend: { position: 'none' }
            };
            
            var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(dataTable, options);
        }
        
        function displayStats(data) {
            let totalCommits = 0;
            let maxCommits = 0;
            let maxMinute = 0;
            let activeMinutes = 0;
            
            data.results.forEach(entry => {
                totalCommits += entry.count;
                if (entry.count > 0) activeMinutes++;
                if (entry.count > maxCommits) {
                    maxCommits = entry.count;
                    maxMinute = entry.minute;
                }
            });
            
            const statsHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalCommits}</div>
                    <div class="stat-label">Total de commits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${maxCommits}</div>
                    <div class="stat-label">Maximum par minute</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${maxMinute}</div>
                    <div class="stat-label">Minute la plus active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${activeMinutes}</div>
                    <div class="stat-label">Minutes avec activit√©</div>
                </div>
            `;
            
            document.getElementById('stats').innerHTML = statsHTML;
        }
    </script>
</body>
</html>